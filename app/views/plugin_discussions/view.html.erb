<%= render :partial => "items/item_header", :locals => {:item => @item, :options => {:show_item_info => true, :show_item_title => true}} %>

<div class="box_style_2" style="margin-bottom:5px">
	<table cellpadding=0 cellspacing=0 style="width:100%">
		<tr>
			<td align=left style="text-align:left">
				<h2 class="title">
					<img src="/themes/<%= @setting[:theme] %>/images/icons/discussion.png" class="icon">
					<%=  "#{@discussion.title}" %>
				</h2>
				<i><%= h @discussion.description if @discussion.description %></i>
			</td>
			<td align=right style="text-align:right">
				<%= friendly_date @discussion.created_at %>
				<%= link_to icon("rss", t("label.rss_feed") + " " + t("label.objects_latest", :objects => PluginDiscussionPost.human_name.pluralize), {:action => "rss", :controller => "plugin_discussions", :id => @item.id, :discussion_id => @discussion.id} %>

				<% if my_group_plugin_permissions[plugin.id].can_update? || item.is_user_owner?(@logged_in_user) || @logged_in_user.is_admin? %>									
					<a href="javascript:replace_box('discussion_box_<%= discussion.id %>','edit_discussion_box_<%= discussion.id %>')">
						<%= icon("edit") %>
					</a>
				<% end %>									
				<% if my_group_plugin_permissions[plugin.id].can_delete? || item.is_user_owner?(@logged_in_user) || @logged_in_user.is_admin? %>									
					<%= link_to icon("delete"), { :action => 'delete', :controller => "plugin_discussions", :id => item.id, :discussion_id => discussion.id}, :confirm => t("confirm.object_delete", :object => plugin.human_name) %>
				<% end %>
				<% if @item.is_editable_for_user?(@logged_in_user)  %>
					<span class="box_style_2" style="padding:2px;">									
			 			<%= "<img src=\"/themes/#{@setting[:theme]}/images/icons/approved.png\" title=\"#{t("single.approved")}\" class=\"icon\">" if discussion.is_approved? %> 										
			 			<%= "<img src=\"/themes/#{@setting[:theme]}/images/icons/unapproved.png\" title=\"#{t("single.not")} #{t("single.approved")}\" class=\"icon\">" if !discussion.is_approved? %> 																							
						<%= link_to "<img src=\"/themes/#{@setting[:theme]}/images/icons/cycle.png\" class=\"icon\">", {:action => "change_approval", :id => item.id, :discussion_id => discussion.id, :controller => "plugin_discussions"}, :confirm => t("confirm.general"), :title => "#{t("label.object_change", :object => "")}", :class => "transparent" %>
					</span>												
				<% end %>					
			</td>							
		</tr>
	</table>
	<div class="spacer"></div>					
	<% if @posts.size > 0 %>
		<%= render :partial => "plugin_discussions/list_posts", :locals => {:posts => @posts, :item => @item} %>
	<% else %>
		<h3><%= t("notice.objects_none_added", :objects => PluginDiscussionPost.human_name.pluralize) %></h3>
	<% end %>

</div>
		

<div align=center style="margin-bottom:5px;">
	<% if @posts.size > 0 %>
		<%= page_entries_info @posts, :entry_name => PluginDiscussionPost.human_name %>
	<% end %>
	<%= will_paginate @posts %>	
</div>

<div class="box_style_2" style="margin-bottom:5px" align=left>
	<a name="new_post"></a>
	<h2 class="title" style="margin-bottom:5px">
		<img src="/themes/<%= @setting[:theme] %>/images/icons/new.png" class="icon">
		<%= t("label.object_new", :object => PluginDiscussionPost.human_name) %>

	</h2>
	<% if !@logged_in_user.anonymous? %>		
	    <%= form_tag  :action => 'create_post', :controller => "plugin_discussions", :id => @item.id, :discussion_id => @discussion.id %>
				<textarea name="post[post]"  id="post_post" onfocus = "focus_input('post_post')" onblur = "blur_input('post_post')" style="width:100%;margin-bottom:5px"></textarea>
	
				<%= submit_tag  t("label.object_create", :object => PluginDiscussionPost.human_name, :class => "button_1") %>
		</form>	
	<% else %>
		<div align=center >
			<img src="/themes/<%= @setting[:theme] %>/images/icons/failure.png" class="icon">
			<%= t("notice.user_not_logged_in") %>
		</div>

	<% end %>
</div>

<br>